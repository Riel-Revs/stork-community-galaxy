<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stork Community Galaxy</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useRef, useState } = React;

    function CommunityBubbles() {
      const canvasRef = useRef(null);
      const [hoveredBubble, setHoveredBubble] = useState(null);
      const [connections, setConnections] = useState(true);
      const [particles, setParticles] = useState(true);
      const [currentBatch, setCurrentBatch] = useState(0);
      const [memberImages, setMemberImages] = useState({});
      const [searchQuery, setSearchQuery] = useState('');
      const [searchResults, setSearchResults] = useState([]);
      const [showResults, setShowResults] = useState(false);
      const [highlighted, setHighlighted] = useState(new Set());
      const [profile, setProfile] = useState(null);
      const [roleFilter, setRoleFilter] = useState('all');
      const [offsetX, setOffsetX] = useState(0);
      const [offsetY, setOffsetY] = useState(0);
      const [isDragging, setIsDragging] = useState(false);
      const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
      
      const BATCH_SIZE = 35, batches = Math.ceil(6000 / BATCH_SIZE); // Adjust if needed
      const roles = [
        { name: 'Peeps', color: '#a855f7', icon: '/assets/peeps.png' },
        { name: 'Winged', color: '#10b981', icon: '/assets/winged.png' },
        { name: 'Songbird', color: '#3b82f6', icon: '/assets/songbird.png' },
        { name: 'Wayfinder', color: '#8b5cf6', icon: '/assets/wayfinder.png' },
        { name: 'Skymaster', color: '#f59e0b', icon: '/assets/skymaster.png' },
        { name: 'Nest-keeper', color: '#ec4899', icon: '/assets/nestkeeper.png' },
        { name: 'Stork Team', color: '#ef4444', icon: '/assets/storkteam.png' }
      ];
      
      const allMembers = useRef([]);
      
      useEffect(() => {
        if (allMembers.current.length === 0) {
          fetch('/members.json')
            .then(res => {
              if (!res.ok) throw new Error('Failed to load members');
              return res.json();
            })
            .then(data => {
              allMembers.current = data.map((m, i) => ({
                ...m,
                id: i,
                role: roles.find(r => r.name === m.role) || roles[0],
              }));
            })
            .catch(err => {
              console.error(err);
              // Fallback fake data
              const pre = ['Shadow', 'Nova', 'Cyber', 'Lunar', 'Storm', 'Neon', 'Pixel', 'Cosmic'];
              const suf = ['Wolf', 'Dragon', 'Phoenix', 'Tiger', 'Hawk', 'Viper', 'Fox', 'Lion'];
              const num = ['', '77', '420', '69', '1337', '404'];
              for (let i = 0; i < 6000; i++) {
                let role, eggs;
                const rand = Math.random();
                
                if (rand < 0.02) {
                  role = roles[6];
                  eggs = Math.floor(Math.random() * 2000000);
                } else if (rand < 0.07) {
                  role = roles[5];
                  eggs = Math.floor(Math.random() * 2000000);
                } else {
                  const eggRand = Math.random();
                  if (eggRand < 0.3) {
                    eggs = Math.floor(Math.random() * 15000);
                    role = roles[0];
                  } else if (eggRand < 0.55) {
                    eggs = 15000 + Math.floor(Math.random() * 60000);
                    role = roles[1];
                  } else if (eggRand < 0.75) {
                    eggs = 75000 + Math.floor(Math.random() * 175000);
                    role = roles[2];
                  } else if (eggRand < 0.9) {
                    eggs = 250000 + Math.floor(Math.random() * 500000);
                    role = roles[3];
                  } else {
                    eggs = 750000 + Math.floor(Math.random() * 1250000);
                    role = roles[4];
                  }
                }
                
                allMembers.current.push({
                  id: i,
                  username: pre[i % pre.length] + suf[Math.floor(i / pre.length) % suf.length] + num[i % num.length],
                  avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + i,
                  online: Math.random() > 0.4,
                  joinedDaysAgo: Math.floor(Math.random() * 365),
                  messageCount: Math.floor(Math.random() * 50000),
                  eggs: eggs,
                  role: role,
                  xProfile: Math.random() > 0.5 ? '@user' + i : null
                });
              }
            });
        }
      }, []);
      
      useEffect(() => {
        if (searchQuery.trim()) {
          const results = allMembers.current.filter(m => m.username.toLowerCase().includes(searchQuery.toLowerCase())).slice(0, 10);
          setSearchResults(results);
          setShowResults(true);
        } else {
          setSearchResults([]);
          setShowResults(false);
          setHighlighted(new Set());
        }
      }, [searchQuery]);
      
      const jump = (id) => {
        setCurrentBatch(Math.floor(id / BATCH_SIZE));
        setHighlighted(new Set([id]));
        setShowResults(false);
        setOffsetX(0);
        setOffsetY(0);
      };
      
      const next = () => {
        setCurrentBatch((p) => (p + 1) % batches);
        setOffsetX(0);
        setOffsetY(0);
      };
      const prev = () => {
        setCurrentBatch((p) => (p - 1 + batches) % batches);
        setOffsetX(0);
        setOffsetY(0);
      };
      
      useEffect(() => {
        const key = (e) => {
          if (e.key === 'ArrowLeft') {
            e.preventDefault();
            prev();
          } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            next();
          } else if (e.key === 'Escape') {
            e.preventDefault();
            setProfile(null);
            setSearchQuery('');
            setHighlighted(new Set());
          } else if (e.key === 'r' || e.key === 'R') {
            e.preventDefault();
            setOffsetX(0);
            setOffsetY(0);
          }
        };
        window.addEventListener('keydown', key);
        return () => window.remove
